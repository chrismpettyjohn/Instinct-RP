{"ast":null,"code":"import _regeneratorRuntime from\"/Users/chris/Projects/instinct/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/chris/Projects/instinct/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"/Users/chris/Projects/instinct/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Users/chris/Projects/instinct/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import{backendAPI,setAPIToken}from'../../api';import{localStorageService}from'../../services/local-storage';var SessionServiceImplementation=/*#__PURE__*/function(){function SessionServiceImplementation(){var _this=this;_classCallCheck(this,SessionServiceImplementation);this.localStorageKey='session';this.logout=function(){localStorageService.delete(_this.localStorageKey);};}_createClass(SessionServiceImplementation,[{key:\"init\",value:function(){var _init=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var authToken;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;authToken=localStorageService.get(this.localStorageKey);_context.next=4;return this.attemptBearerToken(authToken);case 4:return _context.abrupt(\"return\",_context.sent);case 7:_context.prev=7;_context.t0=_context[\"catch\"](0);return _context.abrupt(\"return\",undefined);case 10:case\"end\":return _context.stop();}}},_callee,this,[[0,7]]);}));function init(){return _init.apply(this,arguments);}return init;}()},{key:\"attemptCredentials\",value:function(){var _attemptCredentials=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(username,password){var bearerToken;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return backendAPI.post('session',{username:username,password:password});case 2:bearerToken=_context2.sent;return _context2.abrupt(\"return\",bearerToken.data);case 4:case\"end\":return _context2.stop();}}},_callee2);}));function attemptCredentials(_x,_x2){return _attemptCredentials.apply(this,arguments);}return attemptCredentials;}()},{key:\"attemptBearerToken\",value:function(){var _attemptBearerToken=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(bearerToken){var session;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.prev=0;this.setBearerToken(bearerToken);_context3.next=4;return backendAPI.get('session');case 4:session=_context3.sent;return _context3.abrupt(\"return\",session.data);case 8:_context3.prev=8;_context3.t0=_context3[\"catch\"](0);setAPIToken();throw new Error('Invalid bearer token');case 12:case\"end\":return _context3.stop();}}},_callee3,this,[[0,8]]);}));function attemptBearerToken(_x3){return _attemptBearerToken.apply(this,arguments);}return attemptBearerToken;}()},{key:\"setBearerToken\",value:function setBearerToken(bearerToken){setAPIToken(bearerToken);return bearerToken!==undefined?localStorageService.set(this.localStorageKey,bearerToken):localStorageService.delete(this.localStorageKey);}},{key:\"createSSO\",value:function(){var _createSSO=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(){var sso;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_context4.next=2;return backendAPI.post('session/sso');case 2:sso=_context4.sent;return _context4.abrupt(\"return\",sso.data);case 4:case\"end\":return _context4.stop();}}},_callee4);}));function createSSO(){return _createSSO.apply(this,arguments);}return createSSO;}()},{key:\"getCurrentUser\",value:function(){var _getCurrentUser=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee5(){var user;return _regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:_context5.prev=0;_context5.next=3;return backendAPI.get('session');case 3:user=_context5.sent;return _context5.abrupt(\"return\",user.data);case 7:_context5.prev=7;_context5.t0=_context5[\"catch\"](0);throw new Error('Not Authenticated');case 10:case\"end\":return _context5.stop();}}},_callee5,null,[[0,7]]);}));function getCurrentUser(){return _getCurrentUser.apply(this,arguments);}return getCurrentUser;}()},{key:\"updateClientType\",value:function(){var _updateClientType=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee6(clientType){return _regeneratorRuntime.wrap(function _callee6$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:_context6.next=2;return backendAPI.post('session/settings/preferences',{clientType:clientType});case 2:case\"end\":return _context6.stop();}}},_callee6);}));function updateClientType(_x4){return _updateClientType.apply(this,arguments);}return updateClientType;}()},{key:\"updateProfile\",value:function(){var _updateProfile=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee7(favoriteYoutubeVideo){return _regeneratorRuntime.wrap(function _callee7$(_context7){while(1){switch(_context7.prev=_context7.next){case 0:_context7.next=2;return backendAPI.post('session/settings/preferences',{favoriteYoutubeVideo:favoriteYoutubeVideo});case 2:case\"end\":return _context7.stop();}}},_callee7);}));function updateProfile(_x5){return _updateProfile.apply(this,arguments);}return updateProfile;}()},{key:\"updateEmail\",value:function(){var _updateEmail=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee8(currentPassword,newEmail){return _regeneratorRuntime.wrap(function _callee8$(_context8){while(1){switch(_context8.prev=_context8.next){case 0:_context8.next=2;return backendAPI.post('session/settings/email',{password:currentPassword,email:newEmail});case 2:case\"end\":return _context8.stop();}}},_callee8);}));function updateEmail(_x6,_x7){return _updateEmail.apply(this,arguments);}return updateEmail;}()},{key:\"updatePassword\",value:function(){var _updatePassword=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee9(currentPassword,newPassword,newPasswordAgain){return _regeneratorRuntime.wrap(function _callee9$(_context9){while(1){switch(_context9.prev=_context9.next){case 0:_context9.next=2;return backendAPI.post('session/settings/password',{oldPassword:currentPassword,newPassword:newPassword,newPasswordAgain:newPasswordAgain});case 2:case\"end\":return _context9.stop();}}},_callee9);}));function updatePassword(_x8,_x9,_x10){return _updatePassword.apply(this,arguments);}return updatePassword;}()},{key:\"generateForgotPasswordToken\",value:function(){var _generateForgotPasswordToken=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee10(email){return _regeneratorRuntime.wrap(function _callee10$(_context10){while(1){switch(_context10.prev=_context10.next){case 0:_context10.next=2;return backendAPI.post(\"session/forgot-password?email=\".concat(email));case 2:case\"end\":return _context10.stop();}}},_callee10);}));function generateForgotPasswordToken(_x11){return _generateForgotPasswordToken.apply(this,arguments);}return generateForgotPasswordToken;}()},{key:\"didVoteOnFindRetros\",value:function(){var _didVoteOnFindRetros=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee11(){var response;return _regeneratorRuntime.wrap(function _callee11$(_context11){while(1){switch(_context11.prev=_context11.next){case 0:_context11.next=2;return backendAPI.get('session/findretros');case 2:response=_context11.sent;return _context11.abrupt(\"return\",response.data);case 4:case\"end\":return _context11.stop();}}},_callee11);}));function didVoteOnFindRetros(){return _didVoteOnFindRetros.apply(this,arguments);}return didVoteOnFindRetros;}()},{key:\"redeemForgotPasswordToken\",value:function(){var _redeemForgotPasswordToken=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee12(token,newPassword,newPasswordAgain){return _regeneratorRuntime.wrap(function _callee12$(_context12){while(1){switch(_context12.prev=_context12.next){case 0:_context12.next=2;return backendAPI.post('session/forgot-password/redeem',{token:token,password:newPassword,passwordAgain:newPasswordAgain});case 2:case\"end\":return _context12.stop();}}},_callee12);}));function redeemForgotPasswordToken(_x12,_x13,_x14){return _redeemForgotPasswordToken.apply(this,arguments);}return redeemForgotPasswordToken;}()}]);return SessionServiceImplementation;}();export var sessionService=new SessionServiceImplementation();","map":{"version":3,"sources":["/Users/chris/Projects/instinct/packages/@instinct-web/core/src/services/session/Session.ts"],"names":["backendAPI","setAPIToken","localStorageService","SessionServiceImplementation","localStorageKey","logout","delete","authToken","get","attemptBearerToken","undefined","username","password","post","bearerToken","data","setBearerToken","session","Error","set","sso","user","clientType","favoriteYoutubeVideo","currentPassword","newEmail","email","newPassword","newPasswordAgain","oldPassword","response","token","passwordAgain","sessionService"],"mappings":"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","sourcesContent":["import {AxiosResponse} from 'axios';\nimport {ClientType, User} from '@instinct-prj/interface';\nimport {SessionService} from './Session.types';\nimport {backendAPI, setAPIToken} from '../../api';\nimport {localStorageService} from '../../services/local-storage';\n\nclass SessionServiceImplementation implements SessionService {\n  readonly localStorageKey = 'session';\n\n  async init(): Promise<User | undefined> {\n    try {\n      const authToken: string = localStorageService.get(this.localStorageKey);\n      return await this.attemptBearerToken(authToken);\n    } catch {\n      return undefined;\n    }\n  }\n\n  async attemptCredentials(\n    username: string,\n    password: string\n  ): Promise<string> {\n    const bearerToken: AxiosResponse<string> = await backendAPI.post(\n      'session',\n      {username, password}\n    );\n    return bearerToken.data;\n  }\n\n  async attemptBearerToken(bearerToken: string): Promise<User> {\n    try {\n      this.setBearerToken(bearerToken);\n      const session: AxiosResponse<User> = await backendAPI.get('session');\n      return session.data;\n    } catch {\n      setAPIToken();\n      throw new Error('Invalid bearer token');\n    }\n  }\n\n  setBearerToken(bearerToken: string): void {\n    setAPIToken(bearerToken);\n\n    return bearerToken !== undefined\n      ? localStorageService.set(this.localStorageKey, bearerToken)\n      : localStorageService.delete(this.localStorageKey);\n  }\n\n  async createSSO(): Promise<string> {\n    const sso: AxiosResponse<string> = await backendAPI.post('session/sso');\n    return sso.data;\n  }\n\n  async getCurrentUser(): Promise<User> {\n    try {\n      const user: AxiosResponse<User> = await backendAPI.get('session');\n      return user.data;\n    } catch {\n      throw new Error('Not Authenticated');\n    }\n  }\n\n  logout = () => {\n    localStorageService.delete(this.localStorageKey);\n  };\n\n  async updateClientType(clientType: ClientType): Promise<void> {\n    await backendAPI.post('session/settings/preferences', {clientType});\n  }\n\n  async updateProfile(favoriteYoutubeVideo: string): Promise<void> {\n    await backendAPI.post('session/settings/preferences', {\n      favoriteYoutubeVideo,\n    });\n  }\n\n  async updateEmail(currentPassword: string, newEmail: string): Promise<void> {\n    await backendAPI.post('session/settings/email', {\n      password: currentPassword,\n      email: newEmail,\n    });\n  }\n\n  async updatePassword(\n    currentPassword: string,\n    newPassword: string,\n    newPasswordAgain: string\n  ): Promise<void> {\n    await backendAPI.post('session/settings/password', {\n      oldPassword: currentPassword,\n      newPassword,\n      newPasswordAgain,\n    });\n  }\n\n  async generateForgotPasswordToken(email: string): Promise<void> {\n    await backendAPI.post(`session/forgot-password?email=${email}`);\n  }\n\n  async didVoteOnFindRetros() {\n    const response: AxiosResponse<boolean> = await backendAPI.get(\n      'session/findretros'\n    );\n    return response.data;\n  }\n\n  async redeemForgotPasswordToken(\n    token: string,\n    newPassword: string,\n    newPasswordAgain: string\n  ): Promise<void> {\n    await backendAPI.post('session/forgot-password/redeem', {\n      token,\n      password: newPassword,\n      passwordAgain: newPasswordAgain,\n    });\n  }\n}\n\nexport const sessionService: SessionService =\n  new SessionServiceImplementation();\n"]},"metadata":{},"sourceType":"module"}